/*!
 * OpenUI5
 * (c) Copyright 2009-2023 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/util/UriParameters","sap/base/util/fetch","./_utils"],function(e,n,t){"use strict";function i(e){return Array.isArray(e)?e:[e]}function r(e){return new Promise(function(n,t){sap.ui.require(i(e),function(){n(Array.prototype.slice.call(arguments))},t)})}function o(e,n,t){if(n){for(var i in n){if(Object.hasOwn(t,i)){e[i]=n[i]}}}return e}function u(){function e(e){if(document.body.querySelector("#"+e)==null){var n=document.createElement("div");n.id=e;document.body.insertBefore(n,document.body.firstChild)}}return t.whenDOMReady().then(function(){e("qunit");e("qunit-fixture")})}function a(e){var n=e.sourceFile+":"+e.lineNumber+":"+e.columnNumber,t="Security policy violation: directive '"+e.violatedDirective+"'";if(e.blockedURI){t+=" violated by '"+String(e.blockedURI).slice(0,20)+"'"}if(QUnit.config.current){QUnit.pushFailure(t,n)}else{throw new Error(t+" at "+n)}}var s={altertitle:1,collapse:1,filter:1,fixture:1,hidepassed:1,maxDepth:1,module:1,moduleId:1,notrycatch:1,noglobals:1,seed:1,reorder:1,requireExpects:1,testId:1,testTimeout:1,scrolltop:1};function l(e,n){var t=e.versions;var i=e.version||null;while(typeof i!=="object"){if(!Object.hasOwn(t,i)){throw new TypeError("unsupported "+n+" version "+e.version)}i=t[i]}return i}function c(e){var i,c,f,d,p,h,v,g,m;document.title=e.title;if(e.loader){sap.ui.loader.config(e.loader)}if(e.runAfterLoader){i=r(e.runAfterLoader)}else{i=Promise.resolve()}g=l(e.qunit,"qunit");if(g!=null){window.QUnit=window.QUnit||{};QUnit.config=QUnit.config||{};if(e.qunit!=null&&typeof e.qunit==="object"){o(QUnit.config,e.qunit,s)}QUnit.config.autostart=false;c=i.then(function(){return r("sap/ui/test/qunitPause")}).then(function(){t.addStylesheet(g.css);return r(g.module)}).then(function(){m=[];QUnit.jUnitDone=function(e){m.push(e)};return r("sap/ui/qunit/qunit-junit")}).then(function(){delete QUnit.jUnitDone;return r("sap/ui/thirdparty/qunit-reporter-junit")}).then(function(){m.forEach(function(e){QUnit.jUnitDone(e)});m=undefined})}var b=l(e.sinon,"sinon");if(b!=null){f=i.then(function(){return r(b.module)});if(e.sinon.qunitBridge&&c){d=Promise.all([c,f]).then(function(){return r(b.bridge)})}if(e.sinon!=null&&typeof e.sinon==="object"){p=Promise.all([f,d]).then(function(){sinon.config=o(sinon.config||{},e.sinon,sinon.defaultConfig);return arguments})}}else if(g!=null){sap.ui.loader.config({shim:{"sap/ui/thirdparty/sinon-qunit":{deps:[g.module,"sap/ui/thirdparty/sinon"]},"sap/ui/qunit/sinon-qunit-bridge":{deps:[g.module,"sap/ui/thirdparty/sinon-4"]}}})}h=c.then(function(){if(QUnit.urlParams.coverage===undefined){return{}}if(e.coverage.instrumenter==="blanket"){return{instrumenter:"blanket"}}return n("/.ui5/coverage/ping").then(function(n){if(n.status>=400&&e.coverage.instrumenter!=="istanbul"){return{instrumenter:"blanket"}}else if(n.status>=400){return{instrumenter:null,error:"Istanbul is set as instrumenter, but there's no middleware"}}else{return{instrumenter:"istanbul"}}})}).then(function(e){if(!e.instrumenter){return e}if((QUnit.urlParams["coverage-mode"]||e.instrumenter==="blanket")&&QUnit.urlParams["coverage-mode"]!==e.instrumenter){var n=new URL(window.location.href);n.searchParams.set("coverage","true");n.searchParams.set("coverage-mode",e.instrumenter);window.location=n.toString()}return e}).then(function(n){if(n.instrumenter==="blanket"){return r("sap/ui/thirdparty/blanket").then(function(){if(e.coverage&&window.blanket){if(e.coverage.only!=null){window.blanket.options("sap-ui-cover-only",e.coverage.only)}if(e.coverage.never!=null){window.blanket.options("sap-ui-cover-never",e.coverage.never)}if(e.coverage.branchTracking){window.blanket.options("branchTracking",true)}}return r("sap/ui/qunit/qunit-coverage")}).then(function(){QUnit.config.autostart=false})}else if(n.instrumenter==="istanbul"){return r("sap/ui/qunit/qunit-coverage-istanbul").then(function(){var n=function(e){return Array.isArray(e)?JSON.stringify(e):e};if(e.coverage){var t=document.querySelector('script[src$="qunit/qunit-coverage-istanbul.js"]');if(t){if(e.coverage.only!=null){t.setAttribute("data-sap-ui-cover-only",n(e.coverage.only))}if(e.coverage.never!=null){t.setAttribute("data-sap-ui-cover-never",n(e.coverage.never))}}}})}else if(n.instrumenter===null&&n.error){QUnit.test("There's an error with the instrumentation setup or configuration",function(e){e.ok(false,n.error)})}}).then(function(){var e=QUnit.config.urlConfig.some(function(e){return e.id==="coverage"});if(!e){QUnit.config.urlConfig.push({id:"coverage",label:"Enable coverage",tooltip:"Enable code coverage."})}});h=h.then(function(){if(QUnit.urlParams["sap-ui-xx-csp-policy"]){document.addEventListener("securitypolicyviolation",a);QUnit.done(function(){document.removeEventListener("securitypolicyviolation",a)})}QUnit.config.urlConfig.push({id:"sap-ui-xx-csp-policy",label:"CSP",value:{"sap-target-level-1:report-only":"Level 1","sap-target-level-2:report-only":"Level 2"},tooltip:"What Content-Security-Policy should the server send"});if(QUnit.urlParams["rtf"]||QUnit.urlParams["repeat-to-failure"]){QUnit.done(function(e){if(e.failed===0){setTimeout(function(){location.reload()},100)}})}QUnit.config.urlConfig.push({id:"repeat-to-failure",label:"Repeat",value:false,tooltip:"Whether this test should auto-repeat until it fails"})});v=Promise.all([i,c,f,d,p,h]);if(e.beforeBootstrap){v=v.then(function(){return r(e.beforeBootstrap)})}window["sap-ui-config"]=e.ui5||{};if(Array.isArray(window["sap-ui-config"].libs)){window["sap-ui-config"].libs=window["sap-ui-config"].libs.join(",")}window["sap-ui-test-config"]=e.testConfig||{};if(e.bootCore){v=v.then(function(){return new Promise(function(e,n){sap.ui.require(["sap/ui/core/Core"],function(n){n.boot();n.attachInit(e)},n)})})}return v.then(function(){if(e.autostart){return r(e.module).then(function(e){return Promise.all(e)}).then(function(){return u()}).then(function(){if(e.ui5["xx-waitfortheme"]==="init"){return new Promise(function(e,n){sap.ui.require(["sap/ui/qunit/utils/waitForThemeApplied"],e,n)}).then(function(e){return e()})}}).then(function(){QUnit.start()})}else{return u().then(function(){return r(e.module).then(function(e){return Promise.all(e)})})}})}var f=e.fromQuery(window.location.search),d=t.getAttribute("data-sap-ui-testsuite")||f.get("testsuite"),p=t.getAttribute("data-sap-ui-test")||f.get("test");t.getSuiteConfig(d).then(function(e){var n=e.tests[p];if(!n){throw new TypeError("Invalid test name")}return c(n)}).catch(function(e){console.error(e.stack||e);if(typeof QUnit!=="undefined"){QUnit.test("Test Starter",function(){throw e});QUnit.start()}else{t.whenDOMReady().then(function(){document.body.style.color="red";document.body.innerHTML="<pre>"+t.encode(e.stack||e.message||String(e))+"</pre>"})}})});
//# sourceMappingURL=_setupAndStart.js.map