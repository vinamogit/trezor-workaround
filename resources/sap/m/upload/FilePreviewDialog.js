/*!
 * OpenUI5
 * (c) Copyright 2009-2023 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/Core","sap/ui/core/Element","sap/ui/core/HTML","sap/m/Button","sap/m/Image","sap/m/PDFViewer","sap/m/Dialog","sap/m/IllustratedMessage","sap/m/IllustratedMessageType","sap/m/Carousel","sap/base/Log"],function(e,t,i,a,o,s,n,r,c,l,u){"use strict";var d=sap.ui.getCore().getLibraryResourceBundle("sap.m");var p={Png:"image/png",Bmp:"image/bmp",Jpeg:"image/jpeg",Gif:"image/gif",Txt:"text/plain",Pdf:"application/pdf",ChromePdf:"application/x-google-chrome-pdf",Mpeg:"video/mpeg",Mp4:"video/mp4",Quicktime:"video/quicktime",MsVideo:"video/x-msvideo",Vds:"model/vnd.sap.vds"};var g=t.extend("sap.m.upload.FilePreviewDialog",{library:"sap.m",metadata:{properties:{previewItem:{type:"sap.m.upload.UploadSetTableItem",defaultValue:null},items:{type:"sap.m.upload.UploadSetTableItem[]",defaultValue:[]}},aggregations:{additionalFooterButtons:{type:"sap.m.Button",multiple:true}}},init:function(){this._oRichTextEditor=null;this._oDialog=null;this._oViewer=null;this._oContentResource=null},open:async function(){var e=this.getItems();if(e?.length&&this.getPreviewItem()){this._oCarousel=await this._createCarousel();if(!this._oDialog){this._oDialog=this._createDialog()}else{this._oDialog.setTitle(this.getPreviewItem()?.getFileName()||"");this._oDialog.removeAllContent();this._oDialog.insertContent(this._oCarousel)}this._oDialog.open()}},_loadVkDependency:function(){return new Promise(function(t,i){e.loadLibrary("sap.ui.vk",{async:true}).then(function(){sap.ui.require(["sap/ui/vk/Viewer","sap/ui/vk/ContentResource"],function(e,i){t({viewer:e,contentResource:i})},function(e){i(e)})}).catch(function(){i("sap.ui.vk.Viewer Control not available.")})})},_loadRichTextEditorDependency:function(){return new Promise(function(t,i){e.loadLibrary("sap.ui.richtexteditor",{async:true}).then(function(){sap.ui.require(["sap/ui/richtexteditor/RichTextEditor"],function(e){t(e)},function(e){i(e)})}).catch(function(){i("RichTextEditor Control not available.")})})},_createIllustratedMessage:function(e){const t=new r({illustrationType:c.NoData,title:e,description:"No preview available for this file.",enableVerticalResponsiveness:true});return t},_createVdsViewer:async function(e){if(!this.oViewer||!this._oContentResource){try{const e=await this._loadVkDependency();this._oViewer=e.viewer;this._oContentResource=e.contentResource}catch(e){u.error(e);return null}}const t=new this._oViewer({contentResources:[new this._oContentResource({source:e.getUrl(),sourceType:"vds"})]});return t},_createRichTextEditor:async function(e){if(!this._oRichTextEditor){try{const e=await this._loadRichTextEditorDependency();this._oRichTextEditor=e}catch(e){u.error(e);return null}}const t=new this._oRichTextEditor({height:"100%",width:"100%",editable:false,busy:true});t.attachReady(function(){t.setBusy(false)});const i=new XMLHttpRequest;i.open("GET",e.getUrl(),false);i.send(null);const a=i.responseText;t.setValue(a);return t},_createCarousel:async function(){const e=this.getPreviewItem();const t=this.getItems();var a="";var n=t.map(async t=>{var n=t.getMediaType();var r=t.getFileName();var c=this._createIllustratedMessage(r);if(t.getPreviewable()){switch(n?.toLowerCase()){case p.Png:case p.Bmp:case p.Jpeg:case p.Gif:{c=new o({src:t.getUrl()});break}case p.Txt:{const e=await this._createRichTextEditor(t);if(e){c=e}break}case p.Pdf:case p.ChromePdf:{c=new s({source:t.getUrl(),showDownloadButton:false});c.setBusy(true);break}case p.Mpeg:case p.Mp4:case p.Quicktime:case p.MsVideo:{c=new i({content:"<video controls width='100%' height='100%' src='"+t.getUrl()+"'>"});break}case p.Tiff:case p.Vds:{const e=await this._createVdsViewer(t);if(e){c=e}break}default:break}}a=t?.getId()===e?.getId()?c?.getId():a;return c});const r=await Promise.all(n);const c=new l({showPageIndicator:true,pages:[r],activePage:a,height:"85vh",pageChanged:e=>{var i=r.findIndex(function(t){return t.sId===e.getParameter("newActivePageId")});var a=t[i].getFileName();this._oDialog.setTitle(a)}});return c},_createDialog:function(){var e=this;var t=this._getActiveUploadSetTableItem();var i=new n({title:t.getFileName(),content:e._oCarousel,horizontalScrolling:true,verticalScrolling:true,buttons:[e.getAdditionalFooterButtons(),new a({text:d.getText("UPLOAD_SET_TABLE_FILE_PREVIEW_DIALOG_DOWNLOAD"),press:function(){e._getActiveUploadSetTableItem().download(true)}}),new a({text:d.getText("UPLOAD_SET_TABLE_FILE_PREVIEW_DIALOG_CLOSE"),press:function(){e._oDialog.close()}})]});return i},_getActiveUploadSetTableItem:function(){var e=this._oCarousel.getActivePage();var t=this._oCarousel.getPages();var i=t.findIndex(function(t){return t.sId===e});return this.getItems()[i]}});return g});
//# sourceMappingURL=FilePreviewDialog.js.map